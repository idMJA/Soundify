{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Soundify/src/app/api/invidious/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\n\r\n// Define interfaces for Invidious API responses\r\ninterface InvidiousVideo {\r\n  videoId: string;\r\n  title: string;\r\n  author: string;\r\n  authorId: string;\r\n  lengthSeconds: number;\r\n  videoThumbnails: Array<{\r\n    quality: string;\r\n    url: string;\r\n    width: number;\r\n    height: number;\r\n  }>;\r\n}\r\n\r\ninterface InvidiousSearchResult {\r\n  videos?: InvidiousVideo[];\r\n}\r\n\r\n// Define interfaces for stream formats\r\ninterface InvidiousFormat {\r\n  url: string;\r\n  itag: number;\r\n  type: string;\r\n  quality: string;\r\n  audioQuality?: string;\r\n  container: string;\r\n  encoding: string;\r\n  bitrate: number;\r\n}\r\n\r\ninterface InvidiousStreamInfo {\r\n  title: string;\r\n  videoId: string;\r\n  author: string;\r\n  adaptiveFormats: InvidiousFormat[];\r\n  formatStreams: InvidiousFormat[];\r\n}\r\n\r\n// You can configure a list of Invidious instances to use\r\n// If one fails, the system will try another\r\nconst INVIDIOUS_INSTANCES = [\r\n  \"https://inv.nadeko.net\",  // ðŸ‡¨ðŸ‡± Chile - Primary instance\r\n  \"https://yewtu.be\",        // ðŸ‡©ðŸ‡ª Germany - Backup instance\r\n  \"https://id.420129.xyz\"    // ðŸ‡©ðŸ‡ª Germany - Second backup instance\r\n];\r\n\r\n// Function to search for videos\r\nexport async function searchVideos(query: string): Promise<InvidiousVideo[]> {\r\n  let lastError: Error | null = null;\r\n  \r\n  // Try each instance until one works\r\n  for (const instance of INVIDIOUS_INSTANCES) {\r\n    try {\r\n      console.log(`Searching using Invidious instance: ${instance}`);\r\n      const response = await fetch(`${instance}/api/v1/search?q=${encodeURIComponent(query)}&type=video`, {\r\n        cache: 'no-store',\r\n        next: { revalidate: 0 },\r\n        signal: AbortSignal.timeout(5000) // 5 second timeout\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        console.warn(`Instance ${instance} returned status: ${response.status}`);\r\n        lastError = new Error(`Instance ${instance} returned status: ${response.status}`);\r\n        continue; // Try the next instance\r\n      }\r\n      \r\n      const data = await response.json() as InvidiousVideo[];\r\n      return data;\r\n    } catch (error) {\r\n      console.warn(`Search with instance ${instance} failed:`, error);\r\n      lastError = error instanceof Error ? error : new Error(String(error));\r\n      // Continue to next instance\r\n    }\r\n  }\r\n  \r\n  // If we reach here, all instances failed\r\n  console.error(\"All Invidious instances failed for search\");\r\n  throw lastError || new Error(\"All Invidious instances failed\");\r\n}\r\n\r\n// Function to get streaming URLs for a video\r\nexport async function getVideoStreams(videoId: string): Promise<InvidiousStreamInfo> {\r\n  let lastError: Error | null = null;\r\n  \r\n  // Try each instance until one works\r\n  for (const instance of INVIDIOUS_INSTANCES) {\r\n    try {\r\n      console.log(`Getting video stream from Invidious instance: ${instance}`);\r\n      const response = await fetch(`${instance}/api/v1/videos/${videoId}`, {\r\n        cache: 'no-store',\r\n        next: { revalidate: 0 },\r\n        signal: AbortSignal.timeout(5000) // 5 second timeout\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        console.warn(`Instance ${instance} returned status: ${response.status}`);\r\n        lastError = new Error(`Instance ${instance} returned status: ${response.status}`);\r\n        continue; // Try the next instance\r\n      }\r\n      \r\n      const data = await response.json() as InvidiousStreamInfo;\r\n      return data;\r\n    } catch (error) {\r\n      console.warn(`Get video stream with instance ${instance} failed:`, error);\r\n      lastError = error instanceof Error ? error : new Error(String(error));\r\n      // Continue to next instance\r\n    }\r\n  }\r\n  \r\n  // If we reach here, all instances failed\r\n  console.error(\"All Invidious instances failed for video streams\");\r\n  throw lastError || new Error(\"All Invidious instances failed\");\r\n}\r\n\r\n// Function to get the best audio stream URL\r\nexport function getBestAudioStream(streamInfo: InvidiousStreamInfo): string | null {\r\n  // First try to get an audio-only stream from adaptive formats\r\n  const audioStreams = streamInfo.adaptiveFormats.filter(format => \r\n    format.type.startsWith('audio/') || format.audioQuality\r\n  );\r\n  \r\n  // Sort by bitrate (highest first)\r\n  const sortedStreams = [...audioStreams].sort((a, b) => b.bitrate - a.bitrate);\r\n  \r\n  // Return the URL of the highest quality audio stream, or null if none found\r\n  return sortedStreams.length > 0 ? sortedStreams[0].url : null;\r\n}\r\n\r\n// Check if our service is available (for health check)\r\nexport async function GET() {\r\n  // Try each instance until one works\r\n  for (const instance of INVIDIOUS_INSTANCES) {\r\n    try {\r\n      console.log(`Checking health of Invidious instance: ${instance}`);\r\n      const response = await fetch(`${instance}/api/v1/stats`, {\r\n        cache: 'no-store',\r\n        next: { revalidate: 0 },\r\n        signal: AbortSignal.timeout(3000) // 3 second timeout\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        console.warn(`Instance ${instance} health check failed with status: ${response.status}`);\r\n        continue; // Try the next instance\r\n      }\r\n      \r\n      const stats = await response.json();\r\n      return NextResponse.json({ \r\n        status: \"ok\",\r\n        instance,\r\n        stats: {\r\n          version: stats.version,\r\n          software: stats.software\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.warn(`Health check for instance ${instance} failed:`, error);\r\n      // Continue to next instance\r\n    }\r\n  }\r\n  \r\n  // If we reach here, all instances failed\r\n  console.error(\"All Invidious instances failed health check\");\r\n  return NextResponse.json(\r\n    { error: \"All Invidious API instances are not responding\" }, \r\n    { status: 503 }\r\n  );\r\n} "],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 189, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Soundify/src/app/api/play/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\";\r\nimport { getVideoStreams, getBestAudioStream } from \"../invidious/route\";\r\n\r\n// Global object to track playback state\r\ndeclare global {\r\n  var currentAudioPlayer: HTMLAudioElement | null;\r\n  var currentTrackId: string | null;\r\n}\r\n\r\n// Initialize global state if not already present\r\nif (typeof global.currentAudioPlayer === 'undefined') {\r\n  global.currentAudioPlayer = null;\r\n  global.currentTrackId = null;\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { track } = await request.json();\r\n    \r\n    if (!track || !track.id) {\r\n      return NextResponse.json(\r\n        { error: \"Track information is required\" }, \r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    try {\r\n      // Get stream information from Invidious\r\n      const streamInfo = await getVideoStreams(track.id);\r\n      \r\n      // Get the best audio stream URL\r\n      const audioUrl = getBestAudioStream(streamInfo);\r\n      \r\n      if (!audioUrl) {\r\n        return NextResponse.json(\r\n          { error: \"No suitable audio stream found for this track\" }, \r\n          { status: 404 }\r\n        );\r\n      }\r\n      \r\n      // If we're already playing something, stop it\r\n      if (global.currentAudioPlayer) {\r\n        global.currentAudioPlayer.pause();\r\n        global.currentAudioPlayer = null;\r\n      }\r\n      \r\n      // In a web context, HTMLAudioElement wouldn't exist server-side\r\n      // We're simulating audio playback for the server environment\r\n      // In a real app with client-side playback, this would be handled differently\r\n      global.currentTrackId = track.id;\r\n      \r\n      return NextResponse.json({ \r\n        status: \"playing\",\r\n        trackId: track.id,\r\n        audioUrl: audioUrl,\r\n        title: streamInfo.title,\r\n        author: streamInfo.author\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Stream error:\", error);\r\n      return NextResponse.json(\r\n        { error: \"Failed to get stream information\" }, \r\n        { status: 500 }\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Play error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to play track\" }, \r\n      { status: 500 }\r\n    );\r\n  }\r\n} "],"names":[],"mappings":";;;AAAA;AACA;;;AAQA,iDAAiD;AACjD,IAAI,OAAO,OAAO,kBAAkB,KAAK,aAAa;IACpD,OAAO,kBAAkB,GAAG;IAC5B,OAAO,cAAc,GAAG;AAC1B;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEpC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE;YACvB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI;YACF,wCAAwC;YACxC,MAAM,aAAa,MAAM,CAAA,GAAA,yIAAA,CAAA,kBAAe,AAAD,EAAE,MAAM,EAAE;YAEjD,gCAAgC;YAChC,MAAM,WAAW,CAAA,GAAA,yIAAA,CAAA,qBAAkB,AAAD,EAAE;YAEpC,IAAI,CAAC,UAAU;gBACb,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAAgD,GACzD;oBAAE,QAAQ;gBAAI;YAElB;YAEA,8CAA8C;YAC9C,IAAI,OAAO,kBAAkB,EAAE;gBAC7B,OAAO,kBAAkB,CAAC,KAAK;gBAC/B,OAAO,kBAAkB,GAAG;YAC9B;YAEA,gEAAgE;YAChE,6DAA6D;YAC7D,6EAA6E;YAC7E,OAAO,cAAc,GAAG,MAAM,EAAE;YAEhC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,QAAQ;gBACR,SAAS,MAAM,EAAE;gBACjB,UAAU;gBACV,OAAO,WAAW,KAAK;gBACvB,QAAQ,WAAW,MAAM;YAC3B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmC,GAC5C;gBAAE,QAAQ;YAAI;QAElB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}